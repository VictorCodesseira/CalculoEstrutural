using MathNet.Numerics.LinearAlgebra.Double;

namespace Solver
{
    class CurvedBeam : Element
    {

        Node centerNode;
        double L;
        double kappa;

        public CurvedBeam(Node startNode, Node endNode, Node centerNode, Material material, Section section, int ID)
            :base(startNode, endNode, material, section, ID)
        {
            this.Type = "Curved Beam";
            this.centerNode = centerNode;

            // TODO
            this.L = 1;
            this.kappa = 1;
        }

        public override void SetAddressTable()
        {
            int[] addressTable = new int[18];
            for (int i = 0; i < 6; i++)
            {
                addressTable[i] = startNode.ID * 6 + i;
                addressTable[i + 6] = centerNode.ID * 6 + i;
                addressTable[2*i + 6] = endNode.ID * 6 + i;
            }
            AddressTable = addressTable;
        }

        public double[] NormalForce, ShearForceY, ShearForceZ;
        public double[] Torsion;

        protected override void CalculateLocalStiffnessMatrix()
        {
            double L2 = L * L;
            double L3 = L2 * L;
            double L4 = L3 * L;

            double kappa2 = kappa * kappa;
            double kappa3 = kappa2 * kappa;
            double kappa4 = kappa3 * kappa;
            double kappa6 = kappa3 * kappa3;

            double[,] localStiffnessMatrix = new double[,] {
                {                    (E*(40167*Iz*L4*kappa4 + 112343*A*L4*kappa2 - 4208160*Iz*L2*kappa2 + 161314560*Iz))/(1108800*L3),                                                                                               0,                    -(E*kappa*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 971520*Iz*L2*kappa2 - 1071840*A*L2 + 63233280*Iz))/(2217600*L2),                                                                0,                    (E*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 1050720*Iz*L2*kappa2 + 72103680*Iz))/(2217600*L2),                                                            0,                -(4*E*(24*Iz*L4*kappa4 - 49*A*L4*kappa2 - 1920*Iz*L2*kappa2 + 40320*Iz))/(1575*L3),                                                                                         0,                   -(E*kappa*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 64680*Iz*L2*kappa2 + 27720*A*L2 + 3484800*Iz))/(55440*L2),                                                                0,                  (E*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 60720*Iz*L2*kappa2 + 3041280*Iz))/(55440*L2),                                                        0,                   -(E*(- 27417*Iz*L4*kappa4 - 8393*A*L4*kappa2 + 1198560*Iz*L2*kappa2 + 47773440*Iz))/(1108800*L3),                                                                                               0,                         (E*kappa*(2781*Iz*L4*kappa4 + 2849*A*L4*kappa2 - 549120*Iz*L2*kappa2 + 36960*A*L2 - 6462720*Iz))/(2217600*L2),                                                                 0,                    (E*(- 2781*Iz*L4*kappa4 - 2849*A*L4*kappa2 + 469920*Iz*L2*kappa2 + 15333120*Iz))/(2217600*L2),                                                            0},
                {                                                                                                                          0, (1008216*E*Iy - 8052*E*Iy*L2*kappa2 + 89*E*Iy*L4*kappa4 + 16170*G*J*L2*kappa2)/(6930*L3),                                                                                                                                             0,    -(E*Iy*(5*L4*kappa4 - 880*L2*kappa2 + 150216))/(4620*L2),                                                                                                                       0,    (kappa*(- E*Iy*L2*kappa2 + 868*E*Iy + 980*G*J))/(420*L),                                                                                                        0, -(4*(8064*E*Iy - 48*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 + 210*G*J*L2*kappa2))/(315*L3),                                                                                                                                    0, -(2*E*Iy*(13*L4*kappa4 - 1320*L2*kappa2 + 95040))/(3465*L2),                                                                                                              0, -(4*kappa*(E*Iy*L2*kappa2 + 56*E*Iy + 70*G*J))/(105*L),                                                                                                                         0,     -(298584*E*Iy - 3828*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 - 2310*G*J*L2*kappa2)/(6930*L3),                                                                                                                                             0, -(E*Iy*(- 29*L4*kappa4 + 1320*L2*kappa2 + 95832))/(13860*L2),                                                                                                                       0,  (kappa*(- 11*E*Iy*L2*kappa2 + 28*E*Iy + 140*G*J))/(420*L)},
                { -(E*kappa*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 971520*Iz*L2*kappa2 - 1071840*A*L2 + 63233280*Iz))/(2217600*L2),                                                                                               0, (E*(1949*Iz*L4*kappa6 + 5621*A*L4*kappa4 - 174240*Iz*L2*kappa4 - 813120*A*L2*kappa2 + 77425920*Iz*kappa2 + 31046400*A))/(13305600*L),                                                                0, -(E*kappa*(1949*Iz*L4*kappa4 + 5621*A*L4*kappa2 - 179520*Iz*L2*kappa2 - 406560*A*L2 + 86296320*Iz))/(13305600*L),                                                            0,  (2*E*kappa*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 420*A*L2 + 20160*Iz))/(1575*L2),                                                                                         0, -(E*(13*Iz*L4*kappa6 + 385*A*L4*kappa4 + 35640*Iz*L2*kappa4 - 46200*A*L2*kappa2 - 3484800*Iz*kappa2 + 887040*A))/(332640*L),                                                                0, (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 35376*Iz*L2*kappa2 - 36960*A*L2 - 3041280*Iz))/(332640*L),                                                        0,    -(E*kappa*(2781*Iz*L4*kappa4 + 2849*A*L4*kappa2 - 549120*Iz*L2*kappa2 + 36960*A*L2 - 6462720*Iz))/(2217600*L2),                                                                                               0,  (E*(- 1219*Iz*L4*kappa6 - 1771*A*L4*kappa4 + 332640*Iz*L2*kappa4 + 73920*A*L2*kappa2 - 7729920*Iz*kappa2 + 4435200*A))/(13305600*L),                                                                 0, -(E*kappa*(- 1219*Iz*L4*kappa4 - 1771*A*L4*kappa2 + 327360*Iz*L2*kappa2 + 36960*A*L2 + 1140480*Iz))/(13305600*L),                                                            0},
                {                                                                                                                          0,                                   -(E*Iy*(5*L4*kappa4 - 880*L2*kappa2 + 150216))/(4620*L2),                                                                                                                                             0,        (2*E*Iy*(L4*kappa4 - 154*L2*kappa2 + 16434))/(3465*L),                                                                                                                       0,                       (E*Iy*kappa*(3*L2*kappa2 - 392))/420,                                                                                                        0,                                    (E*Iy*(L4*kappa4 - 90*L2*kappa2 + 8064))/(315*L2),                                                                                                                                    0,       (E*Iy*(- 3*L4*kappa4 + 88*L2*kappa2 + 31680))/(3465*L),                                                                                                              0,                      (E*Iy*kappa*(L2*kappa2 - 14))/105,                                                                                                                         0,                                (E*Iy*(- 29*L4*kappa4 + 1320*L2*kappa2 + 95832))/(13860*L2),                                                                                                                                             0,      (E*Iy*(- 3*L4*kappa4 + 220*L2*kappa2 + 15048))/(13860*L),                                                                                                                       0,                                              (E*Iy*kappa)/15},
                {                       (E*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 1050720*Iz*L2*kappa2 + 72103680*Iz))/(2217600*L2),                                                                                               0,                       -(E*kappa*(1949*Iz*L4*kappa4 + 5621*A*L4*kappa2 - 179520*Iz*L2*kappa2 - 406560*A*L2 + 86296320*Iz))/(13305600*L),                                                                0,                      (E*(1949*Iz*L4*kappa4 + 5621*A*L4*kappa2 - 184800*Iz*L2*kappa2 + 126213120*Iz))/(13305600*L),                                                            0,                   -(2*E*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 20160*Iz))/(1575*L2),                                                                                         0,                        (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 47256*Iz*L2*kappa2 - 9240*A*L2 - 4371840*Iz))/(332640*L),                                                                0,                    -(E*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 46992*Iz*L2*kappa2 - 3041280*Iz))/(332640*L),                                                        0,                     -(E*(- 2781*Iz*L4*kappa4 - 2849*A*L4*kappa2 + 469920*Iz*L2*kappa2 + 15333120*Iz))/(2217600*L2),                                                                                               0,                       -(E*kappa*(- 1219*Iz*L4*kappa4 - 1771*A*L4*kappa2 + 327360*Iz*L2*kappa2 + 36960*A*L2 + 1140480*Iz))/(13305600*L),                                                                 0,                     (E*(- 1219*Iz*L4*kappa4 - 1771*A*L4*kappa2 + 322080*Iz*L2*kappa2 + 14446080*Iz))/(13305600*L),                                                            0},
                {                                                                                                                          0,                                       (kappa*(- E*Iy*L2*kappa2 + 868*E*Iy + 980*G*J))/(420*L),                                                                                                                                             0,                           (E*Iy*kappa*(3*L2*kappa2 - 392))/420,                                                                                                                       0,                         (2*E*Iy*L2*kappa2 + 35*G*J)/(15*L),                                                                                                        0,                              -(kappa*(- 3*E*Iy*L2*kappa2 + 224*E*Iy + 280*G*J))/(105*L),                                                                                                                                    0,                                        -(2*E*Iy*L2*kappa3)/105,                                                                                                              0,                    -(- E*Iy*L2*kappa2 + 40*G*J)/(15*L),                                                                                                                         0,                                     (kappa*(- 11*E*Iy*L2*kappa2 + 28*E*Iy + 140*G*J))/(420*L),                                                                                                                                             0,                                                  -(E*Iy*kappa)/15,                                                                                                                       0,                         (- E*Iy*L2*kappa2 + 10*G*J)/(30*L)},
                {                                  -(4*E*(24*Iz*L4*kappa4 - 49*A*L4*kappa2 - 1920*Iz*L2*kappa2 + 40320*Iz))/(1575*L3),                                                                                               0,                                       (2*E*kappa*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 420*A*L2 + 20160*Iz))/(1575*L2),                                                                0,                                  -(2*E*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 20160*Iz))/(1575*L2),                                                            0,                    (64*E*(3*Iz*L4*kappa4 + 7*A*L4*kappa2 - 240*Iz*L2*kappa2 + 5040*Iz))/(1575*L3),                                                                                         0,                                                                                                                                    0,                                                                0,                                                                                                              0,                                                        0,                                 -(4*E*(24*Iz*L4*kappa4 - 49*A*L4*kappa2 - 1920*Iz*L2*kappa2 + 40320*Iz))/(1575*L3),                                                                                               0,                                      -(2*E*kappa*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 420*A*L2 + 20160*Iz))/(1575*L2),                                                                 0,                                   (2*E*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 20160*Iz))/(1575*L2),                                                            0},
                {                                                                                                                          0,       -(4*(8064*E*Iy - 48*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 + 210*G*J*L2*kappa2))/(315*L3),                                                                                                                                             0,           (E*Iy*(L4*kappa4 - 90*L2*kappa2 + 8064))/(315*L2),                                                                                                                       0, -(kappa*(- 3*E*Iy*L2*kappa2 + 224*E*Iy + 280*G*J))/(105*L),                                                                                                        0,  (8*(8064*E*Iy - 48*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 + 210*G*J*L2*kappa2))/(315*L3),                                                                                                                                    0,                                                                0,                                                                                                              0,  (8*kappa*(E*Iy*L2*kappa2 + 56*E*Iy + 70*G*J))/(105*L),                                                                                                                         0,       -(4*(8064*E*Iy - 48*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 + 210*G*J*L2*kappa2))/(315*L3),                                                                                                                                             0,           -(E*Iy*(L4*kappa4 - 90*L2*kappa2 + 8064))/(315*L2),                                                                                                                       0, -(kappa*(- 3*E*Iy*L2*kappa2 + 224*E*Iy + 280*G*J))/(105*L)},
                {         -(E*kappa*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 64680*Iz*L2*kappa2 + 27720*A*L2 + 3484800*Iz))/(55440*L2),                                                                                               0,          -(E*(13*Iz*L4*kappa6 + 385*A*L4*kappa4 + 35640*Iz*L2*kappa4 - 46200*A*L2*kappa2 - 3484800*Iz*kappa2 + 887040*A))/(332640*L),                                                                0,           (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 47256*Iz*L2*kappa2 - 9240*A*L2 - 4371840*Iz))/(332640*L),                                                            0,                                                                                                        0,                                                                                         0,  (E*(241*Iz*L4*kappa6 + 385*A*L4*kappa4 - 39600*Iz*L2*kappa4 - 18480*A*L2*kappa2 + 1742400*Iz*kappa2 + 221760*A))/(41580*L),                                                                0, -(E*kappa*(241*Iz*L4*kappa4 + 385*A*L4*kappa2 - 36696*Iz*L2*kappa2 - 9240*A*L2 + 1520640*Iz))/(41580*L),                                                        0,         (E*kappa*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 64680*Iz*L2*kappa2 + 27720*A*L2 + 3484800*Iz))/(55440*L2),                                                                                               0,          -(E*(13*Iz*L4*kappa6 + 385*A*L4*kappa4 + 35640*Iz*L2*kappa4 - 46200*A*L2*kappa2 - 3484800*Iz*kappa2 + 887040*A))/(332640*L),                                                                 0,           (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 47256*Iz*L2*kappa2 - 9240*A*L2 - 4371840*Iz))/(332640*L),                                                            0},
                {                                                                                                                          0,                                -(2*E*Iy*(13*L4*kappa4 - 1320*L2*kappa2 + 95040))/(3465*L2),                                                                                                                                             0,       (E*Iy*(- 3*L4*kappa4 + 88*L2*kappa2 + 31680))/(3465*L),                                                                                                                       0,                                    -(2*E*Iy*L2*kappa3)/105,                                                                                                        0,                                                                                         0,                                                                                                                                    0,         (32*E*Iy*(L4*kappa4 - 88*L2*kappa2 + 3960))/(3465*L),                                                                                                              0,                                                        0,                                                                                                                         0,                                 (2*E*Iy*(13*L4*kappa4 - 1320*L2*kappa2 + 95040))/(3465*L2),                                                                                                                                             0,        (E*Iy*(- 3*L4*kappa4 + 88*L2*kappa2 + 31680))/(3465*L),                                                                                                                       0,                                     (2*E*Iy*L2*kappa3)/105},
                {                              (E*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 60720*Iz*L2*kappa2 + 3041280*Iz))/(55440*L2),                                                                                               0,                                (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 35376*Iz*L2*kappa2 - 36960*A*L2 - 3041280*Iz))/(332640*L),                                                                0,                             -(E*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 46992*Iz*L2*kappa2 - 3041280*Iz))/(332640*L),                                                            0,                                                                                                        0,                                                                                         0,                       -(E*kappa*(241*Iz*L4*kappa4 + 385*A*L4*kappa2 - 36696*Iz*L2*kappa2 - 9240*A*L2 + 1520640*Iz))/(41580*L),                                                                0,                     (E*(241*Iz*L4*kappa4 + 385*A*L4*kappa2 - 33792*Iz*L2*kappa2 + 1520640*Iz))/(41580*L),                                                        0,                            -(E*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 60720*Iz*L2*kappa2 + 3041280*Iz))/(55440*L2),                                                                                               0,                                (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 35376*Iz*L2*kappa2 - 36960*A*L2 - 3041280*Iz))/(332640*L),                                                                 0,                             -(E*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 46992*Iz*L2*kappa2 - 3041280*Iz))/(332640*L),                                                            0},
                {                                                                                                                          0,                                        -(4*kappa*(E*Iy*L2*kappa2 + 56*E*Iy + 70*G*J))/(105*L),                                                                                                                                             0,                              (E*Iy*kappa*(L2*kappa2 - 14))/105,                                                                                                                       0,                        -(- E*Iy*L2*kappa2 + 40*G*J)/(15*L),                                                                                                        0,                                   (8*kappa*(E*Iy*L2*kappa2 + 56*E*Iy + 70*G*J))/(105*L),                                                                                                                                    0,                                                                0,                                                                                                              0,                   (8*(E*Iy*L2*kappa2 + 10*G*J))/(15*L),                                                                                                                         0,                                        -(4*kappa*(E*Iy*L2*kappa2 + 56*E*Iy + 70*G*J))/(105*L),                                                                                                                                             0,                              -(E*Iy*kappa*(L2*kappa2 - 14))/105,                                                                                                                       0,                        -(- E*Iy*L2*kappa2 + 40*G*J)/(15*L)},
                {                    -(E*(- 27417*Iz*L4*kappa4 - 8393*A*L4*kappa2 + 1198560*Iz*L2*kappa2 + 47773440*Iz))/(1108800*L3),                                                                                               0,                        -(E*kappa*(2781*Iz*L4*kappa4 + 2849*A*L4*kappa2 - 549120*Iz*L2*kappa2 + 36960*A*L2 - 6462720*Iz))/(2217600*L2),                                                                0,                   -(E*(- 2781*Iz*L4*kappa4 - 2849*A*L4*kappa2 + 469920*Iz*L2*kappa2 + 15333120*Iz))/(2217600*L2),                                                            0,                -(4*E*(24*Iz*L4*kappa4 - 49*A*L4*kappa2 - 1920*Iz*L2*kappa2 + 40320*Iz))/(1575*L3),                                                                                         0,                    (E*kappa*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 64680*Iz*L2*kappa2 + 27720*A*L2 + 3484800*Iz))/(55440*L2),                                                                0,                 -(E*(317*Iz*L4*kappa4 - 1155*A*L4*kappa2 - 60720*Iz*L2*kappa2 + 3041280*Iz))/(55440*L2),                                                        0,                   (E*(40167*Iz*L4*kappa4 + 112343*A*L4*kappa2 - 4208160*Iz*L2*kappa2 + 161314560*Iz))/(1108800*L3),                                                                                               0,                     (E*kappa*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 971520*Iz*L2*kappa2 - 1071840*A*L2 + 63233280*Iz))/(2217600*L2),                                                                 0,                   -(E*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 1050720*Iz*L2*kappa2 + 72103680*Iz))/(2217600*L2),                                                            0},
                {                                                                                                                          0,     -(298584*E*Iy - 3828*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 - 2310*G*J*L2*kappa2)/(6930*L3),                                                                                                                                             0, (E*Iy*(- 29*L4*kappa4 + 1320*L2*kappa2 + 95832))/(13860*L2),                                                                                                                       0,  (kappa*(- 11*E*Iy*L2*kappa2 + 28*E*Iy + 140*G*J))/(420*L),                                                                                                        0, -(4*(8064*E*Iy - 48*E*Iy*L2*kappa2 + E*Iy*L4*kappa4 + 210*G*J*L2*kappa2))/(315*L3),                                                                                                                                    0,  (2*E*Iy*(13*L4*kappa4 - 1320*L2*kappa2 + 95040))/(3465*L2),                                                                                                              0, -(4*kappa*(E*Iy*L2*kappa2 + 56*E*Iy + 70*G*J))/(105*L),                                                                                                                         0, (1008216*E*Iy - 8052*E*Iy*L2*kappa2 + 89*E*Iy*L4*kappa4 + 16170*G*J*L2*kappa2)/(6930*L3),                                                                                                                                             0,      (E*Iy*(5*L4*kappa4 - 880*L2*kappa2 + 150216))/(4620*L2),                                                                                                                       0,    (kappa*(- E*Iy*L2*kappa2 + 868*E*Iy + 980*G*J))/(420*L)},
                {      (E*kappa*(2781*Iz*L4*kappa4 + 2849*A*L4*kappa2 - 549120*Iz*L2*kappa2 + 36960*A*L2 - 6462720*Iz))/(2217600*L2),                                                                                               0,  (E*(- 1219*Iz*L4*kappa6 - 1771*A*L4*kappa4 + 332640*Iz*L2*kappa4 + 73920*A*L2*kappa2 - 7729920*Iz*kappa2 + 4435200*A))/(13305600*L),                                                                0, -(E*kappa*(- 1219*Iz*L4*kappa4 - 1771*A*L4*kappa2 + 327360*Iz*L2*kappa2 + 36960*A*L2 + 1140480*Iz))/(13305600*L),                                                            0, -(2*E*kappa*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 420*A*L2 + 20160*Iz))/(1575*L2),                                                                                         0, -(E*(13*Iz*L4*kappa6 + 385*A*L4*kappa4 + 35640*Iz*L2*kappa4 - 46200*A*L2*kappa2 - 3484800*Iz*kappa2 + 887040*A))/(332640*L),                                                                0, (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 35376*Iz*L2*kappa2 - 36960*A*L2 - 3041280*Iz))/(332640*L),                                                        0, (E*kappa*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 971520*Iz*L2*kappa2 - 1071840*A*L2 + 63233280*Iz))/(2217600*L2),                                                                                               0, (E*(1949*Iz*L4*kappa6 + 5621*A*L4*kappa4 - 174240*Iz*L2*kappa4 - 813120*A*L2*kappa2 + 77425920*Iz*kappa2 + 31046400*A))/(13305600*L),                                                                 0, -(E*kappa*(1949*Iz*L4*kappa4 + 5621*A*L4*kappa2 - 179520*Iz*L2*kappa2 - 406560*A*L2 + 86296320*Iz))/(13305600*L),                                                            0},
                {                                                                                                                          0,                               -(E*Iy*(- 29*L4*kappa4 + 1320*L2*kappa2 + 95832))/(13860*L2),                                                                                                                                             0,     (E*Iy*(- 3*L4*kappa4 + 220*L2*kappa2 + 15048))/(13860*L),                                                                                                                       0,                                             -(E*Iy*kappa)/15,                                                                                                        0,                                   -(E*Iy*(L4*kappa4 - 90*L2*kappa2 + 8064))/(315*L2),                                                                                                                                    0,       (E*Iy*(- 3*L4*kappa4 + 88*L2*kappa2 + 31680))/(3465*L),                                                                                                              0,                     -(E*Iy*kappa*(L2*kappa2 - 14))/105,                                                                                                                         0,                                    (E*Iy*(5*L4*kappa4 - 880*L2*kappa2 + 150216))/(4620*L2),                                                                                                                                             0,         (2*E*Iy*(L4*kappa4 - 154*L2*kappa2 + 16434))/(3465*L),                                                                                                                       0,                      -(E*Iy*kappa*(3*L2*kappa2 - 392))/420},
                {                       (E*(- 2781*Iz*L4*kappa4 - 2849*A*L4*kappa2 + 469920*Iz*L2*kappa2 + 15333120*Iz))/(2217600*L2),                                                                                               0,                       -(E*kappa*(- 1219*Iz*L4*kappa4 - 1771*A*L4*kappa2 + 327360*Iz*L2*kappa2 + 36960*A*L2 + 1140480*Iz))/(13305600*L),                                                                0,                     (E*(- 1219*Iz*L4*kappa4 - 1771*A*L4*kappa2 + 322080*Iz*L2*kappa2 + 14446080*Iz))/(13305600*L),                                                            0,                    (2*E*(2*Iz*L4*kappa4 - 7*A*L4*kappa2 - 540*Iz*L2*kappa2 + 20160*Iz))/(1575*L2),                                                                                         0,                        (E*kappa*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 47256*Iz*L2*kappa2 - 9240*A*L2 - 4371840*Iz))/(332640*L),                                                                0,                    -(E*(13*Iz*L4*kappa4 + 385*A*L4*kappa2 + 46992*Iz*L2*kappa2 - 3041280*Iz))/(332640*L),                                                        0,                     -(E*(2851*Iz*L4*kappa4 + 14399*A*L4*kappa2 - 1050720*Iz*L2*kappa2 + 72103680*Iz))/(2217600*L2),                                                                                               0,                       -(E*kappa*(1949*Iz*L4*kappa4 + 5621*A*L4*kappa2 - 179520*Iz*L2*kappa2 - 406560*A*L2 + 86296320*Iz))/(13305600*L),                                                                 0,                      (E*(1949*Iz*L4*kappa4 + 5621*A*L4*kappa2 - 184800*Iz*L2*kappa2 + 126213120*Iz))/(13305600*L),                                                            0},
                {                                                                                                                          0,                                     (kappa*(- 11*E*Iy*L2*kappa2 + 28*E*Iy + 140*G*J))/(420*L),                                                                                                                                             0,                                                  (E*Iy*kappa)/15,                                                                                                                       0,                         (- E*Iy*L2*kappa2 + 10*G*J)/(30*L),                                                                                                        0,                              -(kappa*(- 3*E*Iy*L2*kappa2 + 224*E*Iy + 280*G*J))/(105*L),                                                                                                                                    0,                                         (2*E*Iy*L2*kappa3)/105,                                                                                                              0,                    -(- E*Iy*L2*kappa2 + 40*G*J)/(15*L),                                                                                                                         0,                                       (kappa*(- E*Iy*L2*kappa2 + 868*E*Iy + 980*G*J))/(420*L),                                                                                                                                             0,                           -(E*Iy*kappa*(3*L2*kappa2 - 392))/420,                                                                                                                       0,                         (2*E*Iy*L2*kappa2 + 35*G*J)/(15*L)}
            };




            LocalStiffnessMatrix = DenseMatrix.OfArray(localStiffnessMatrix);
        }

        protected override void CalculateEquivalentNodalForcesVector()
        {
            EquivalentNodalForcesVector = new DenseVector(18);
        }

        public override void CalculateStress()
        {
            DenseVector u = NodalDisplacementsVector;
            double L2 = L * L;
            double L3 = L2 * L;
            double L4 = L3 * L;
            double L5 = L4 * L;

            double kappa2 = kappa * kappa;

            NormalForce = new double[] { -A * E * ((73 * kappa * u[0]) / 120 + (8 * kappa * u[6]) / 15 - (17 * kappa * u[12]) / 120 + (3 * L * kappa * u[4]) / 80 - (L * kappa * u[10]) / 6 + (L * kappa * u[16]) / 240 + (u[8] * (L2 * kappa2 - 24)) / (6 * L) - (3 * u[2] * (L2 * kappa2 - 80)) / (80 * L) - (u[14] * (L2 * kappa2 - 240)) / (240 * L)), -A * E * ((kappa * u[10]) / 3 - (25 * kappa * u[4]) / 24 - (kappa * u[16]) / 24 + kappa * (u[4] - kappa * u[2]) - (u[8] * (L2 * kappa2 - 24)) / (3 * L2) + (u[14] * (L2 * kappa2 - 96)) / (24 * L2) + (u[2] * (25 * L2 * kappa2 - 96)) / (24 * L2) - (3 * kappa * u[0]) / (4 * L) + (3 * kappa * u[12]) / (4 * L)) };
            ShearForceY = new double[] { -E * Iy * ((12 * u[3]) / L - (46 * u[1]) / L2 - kappa * u[5] + (32 * u[7]) / L2 + (16 * u[9]) / L + (14 * u[13]) / L2 + (2 * u[15]) / L), E * Iy * ((78 * u[3]) / L2 - (396 * u[1]) / L3 + (192 * u[7]) / L3 + (192 * u[9]) / L2 + (204 * u[13]) / L3 + (30 * u[15]) / L2 - kappa * ((3 * u[5]) / L - kappa * u[3] - (4 * u[11]) / L + u[17] / L + (3 * kappa * u[1]) / L - (4 * kappa * u[7]) / L + (kappa * u[13]) / L)), -E * Iy * (kappa * ((4 * u[11]) / L2 - (2 * u[5]) / L2 - (2 * u[17]) / L2 - (25 * kappa * u[1]) / L2 + (6 * kappa * u[3]) / L + (20 * kappa * u[7]) / L2 + (8 * kappa * u[9]) / L + (5 * kappa * u[13]) / L2 + (kappa * u[15]) / L) - (816 * u[1]) / L4 + (144 * u[3]) / L3 + (192 * u[7]) / L4 + (480 * u[9]) / L3 + (624 * u[13]) / L4 + (96 * u[15]) / L3), E * Iy * ((80 * u[3]) / L4 - (480 * u[1]) / L5 + (320 * u[9]) / L4 + (480 * u[13]) / L5 + (80 * u[15]) / L4 + kappa2 * ((13 * u[3]) / L2 - (66 * u[1]) / L3 + (32 * u[7]) / L3 + (32 * u[9]) / L2 + (34 * u[13]) / L3 + (5 * u[15]) / L2)), -E * Iy * kappa2 * ((12 * u[3]) / L3 - (68 * u[1]) / L4 + (16 * u[7]) / L4 + (40 * u[9]) / L3 + (52 * u[13]) / L4 + (8 * u[15]) / L3), E * Iy * kappa2 * ((4 * u[3]) / L4 - (24 * u[1]) / L5 + (16 * u[9]) / L4 + (24 * u[13]) / L5 + (4 * u[15]) / L4) };
            ShearForceZ = new double[] { E * Iz * ((32 * u[6]) / L2 - (12 * u[4]) / L - (46 * u[0]) / L2 - (16 * u[10]) / L + (14 * u[12]) / L2 - (2 * u[16]) / L + kappa * ((47 * kappa * u[0]) / 120 - (8 * kappa * u[6]) / 15 + (17 * kappa * u[12]) / 120 - (3 * L * kappa * u[4]) / 80 + (L * kappa * u[10]) / 6 - (L * kappa * u[16]) / 240 - (u[8] * (L2 * kappa2 - 24)) / (6 * L) + (3 * u[2] * (L2 * kappa2 - 80)) / (80 * L) + (u[14] * (L2 * kappa2 - 240)) / (240 * L)) + (12 * kappa * u[2]) / L + (16 * kappa * u[8]) / L + (2 * kappa * u[14]) / L), E * Iz * ((396 * u[0]) / L3 + (78 * u[4]) / L2 - (192 * u[6]) / L3 + (192 * u[10]) / L2 - (204 * u[12]) / L3 + (30 * u[16]) / L2 + 2 * kappa * ((25 * kappa * u[4]) / 48 - (kappa * u[10]) / 6 + (kappa * u[16]) / 48 + (u[8] * (L2 * kappa2 - 24)) / (6 * L2) - (u[14] * (L2 * kappa2 - 96)) / (48 * L2) - (u[2] * (25 * L2 * kappa2 - 96)) / (48 * L2) + (3 * kappa * u[0]) / (8 * L) - (3 * kappa * u[12]) / (8 * L)) - (78 * kappa * u[2]) / L2 - (192 * kappa * u[8]) / L2 - (30 * kappa * u[14]) / L2), E * Iz * (kappa2 * ((16 * u[6]) / L2 - (6 * u[4]) / L - (23 * u[0]) / L2 - (8 * u[10]) / L + (7 * u[12]) / L2 - u[16] / L + (6 * kappa * u[2]) / L + (8 * kappa * u[8]) / L + (kappa * u[14]) / L) - (816 * u[0]) / L4 - (144 * u[4]) / L3 + (192 * u[6]) / L4 - (480 * u[10]) / L3 + (624 * u[12]) / L4 - (96 * u[16]) / L3 + (144 * kappa * u[2]) / L3 + (480 * kappa * u[8]) / L3 + (96 * kappa * u[14]) / L3), -E * Iz * (kappa2 * ((32 * u[6]) / L3 - (13 * u[4]) / L2 - (66 * u[0]) / L3 - (32 * u[10]) / L2 + (34 * u[12]) / L3 - (5 * u[16]) / L2 + (13 * kappa * u[2]) / L2 + (32 * kappa * u[8]) / L2 + (5 * kappa * u[14]) / L2) - (480 * u[0]) / L5 - (80 * u[4]) / L4 - (320 * u[10]) / L4 + (480 * u[12]) / L5 - (80 * u[16]) / L4 + (80 * kappa * u[2]) / L4 + (320 * kappa * u[8]) / L4 + (80 * kappa * u[14]) / L4), E * Iz * kappa2 * ((16 * u[6]) / L4 - (12 * u[4]) / L3 - (68 * u[0]) / L4 - (40 * u[10]) / L3 + (52 * u[12]) / L4 - (8 * u[16]) / L3 + (12 * kappa * u[2]) / L3 + (40 * kappa * u[8]) / L3 + (8 * kappa * u[14]) / L3), E * Iz * kappa2 * ((24 * u[0]) / L5 + (4 * u[4]) / L4 + (16 * u[10]) / L4 - (24 * u[12]) / L5 + (4 * u[16]) / L4 - (4 * kappa * u[2]) / L4 - (16 * kappa * u[8]) / L4 - (4 * kappa * u[14]) / L4) };
            Torsion = new double[] { -G * J * ((3 * u[5]) / L - (4 * u[11]) / L + u[17] / L + (3 * kappa * u[1]) / L - (4 * kappa * u[7]) / L + (kappa * u[13]) / L), -G * J * ((8 * u[11]) / L2 - (4 * u[5]) / L2 - 2 * kappa * ((6 * u[3]) / L - (23 * u[1]) / L2 + (16 * u[7]) / L2 + (8 * u[9]) / L + (7 * u[13]) / L2 + u[15] / L) - (4 * u[17]) / L2 - (50 * kappa * u[1]) / L2 + (12 * kappa * u[3]) / L + (40 * kappa * u[7]) / L2 + (16 * kappa * u[9]) / L + (10 * kappa * u[13]) / L2 + (2 * kappa * u[15]) / L) };
        }

    }
}
